@model InvoiceManagement.Services.DashboardStats

@{
    ViewData["Title"] = "Admin Dashboard";
}
@functions {
    public string FormatCurrency(decimal amount)
    {
        var settings = ViewData["CurrencySettings"] as CurrencySettings;
        if (settings != null)
        {
            return CurrencyHelper.FormatCurrency(amount, settings);
        }
        return $"K {amount:N2}";
    }
    public string CurrencySymbol()
    {
        return ViewData["CurrencySymbol"]?.ToString() ?? "K";
    }
}


<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-speedometer2"></i> Admin Dashboard</h1>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card border-primary">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Users</h6>
                <h2 class="card-title text-primary">@Model.ActiveUsers / @Model.TotalUsers</h2>
                <p class="card-text small">Active Users</p>
                <a asp-action="Users" class="btn btn-sm btn-outline-primary">Manage Users</a>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card border-success">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Suppliers</h6>
                <h2 class="card-title text-success">@Model.ActiveSuppliers / @Model.TotalSuppliers</h2>
                <p class="card-text small">Active Suppliers</p>
                <a asp-action="Suppliers" class="btn btn-sm btn-outline-success">Manage Suppliers</a>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card border-warning">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Requisitions</h6>
                <h2 class="card-title text-warning">@Model.PendingRequisitions</h2>
                <p class="card-text small">Pending Approvals</p>
                <a asp-controller="Requisitions" asp-action="Index" class="btn btn-sm btn-outline-warning">View All</a>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card border-info">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Purchase Orders</h6>
                <h2 class="card-title text-info">@Model.OpenPurchaseOrders</h2>
                <p class="card-text small">Open POs</p>
                <a asp-controller="PurchaseOrders" asp-action="Index" class="btn btn-sm btn-outline-info">View All</a>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-file-earmark-text"></i> Invoices</h5>
                <p class="mb-1"><strong>Total Invoices:</strong> @Model.TotalInvoices</p>
                <p class="mb-1"><strong>Unpaid:</strong> @Model.UnpaidInvoices</p>
                <p class="mb-1"><strong>Total Unpaid:</strong> <span
                        class="text-danger">@FormatCurrency(Model.TotalUnpaidAmount)</span></p>
                <a asp-controller="Invoices" asp-action="Index" class="btn btn-sm btn-primary mt-2">View Invoices</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-box-seam"></i> Procurement</h5>
                <p class="mb-1"><strong>Total Requisitions:</strong> @Model.TotalRequisitions</p>
                <p class="mb-1"><strong>Pending Approval:</strong> @Model.PendingRequisitions</p>
                <p class="mb-1"><strong>Total POs:</strong> @Model.TotalPurchaseOrders</p>
                <a asp-action="AuditLogs" asp-route-entity="Requisition" class="btn btn-sm btn-primary mt-2">View
                    Activity</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-activity"></i> System Activity</h5>
                <p class="mb-1"><strong>Today's Actions:</strong> @Model.TodayActions</p>
                <p class="mb-1"><strong>Active Suppliers:</strong> @Model.ActiveSuppliers</p>
                <p class="mb-1"><strong>Active Users:</strong> @Model.ActiveUsers</p>
                <a asp-action="AuditLogs" class="btn btn-sm btn-primary mt-2">View Audit Logs</a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="m-0"><i class="bi bi-clock-history"></i> Recent Activity</h5>
            </div>
            <div class="card-body">
                @if (ViewBag.RecentLogs != null && ((IEnumerable<AuditLog>)ViewBag.RecentLogs).Any())
                {
                    <table class="table table-sm table-hover">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Entity</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var log in (IEnumerable<AuditLog>)ViewBag.RecentLogs)
                            {
                                <tr>
                                    <td><small>@log.ActionDate.ToString("yyyy-MM-dd HH:mm")</small></td>
                                    <td>@log.Username</td>
                                    <td><span class="badge bg-info">@log.Action</span></td>
                                    <td>@log.Entity</td>
                                    <td><small>@log.Details</small></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <a asp-action="AuditLogs" class="btn btn-sm btn-outline-primary">View All Logs</a>
                }
                else
                {
                    <p class="text-muted">No recent activity</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="m-0"><i class="bi bi-gear"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a asp-action="CreateUser" class="btn btn-outline-primary w-100">
                            <i class="bi bi-person-plus"></i> Add New User
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a asp-action="CreateSupplier" class="btn btn-outline-success w-100">
                            <i class="bi bi-building-add"></i> Add New Supplier
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a asp-action="Settings" class="btn btn-outline-info w-100">
                            <i class="bi bi-sliders"></i> System Settings
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a asp-controller="Reports" asp-action="Index" class="btn btn-outline-warning w-100">
                            <i class="bi bi-file-earmark-bar-graph"></i> Generate Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Admin Management Tools -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="m-0"><i class="bi bi-tools"></i> Admin Management Tools</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4 col-lg-2">
                        <a asp-action="SystemHealth" class="btn btn-outline-danger w-100 py-3">
                            <i class="bi bi-heart-pulse fs-4 d-block mb-1"></i>
                            <small>System Health</small>
                        </a>
                    </div>
                    <div class="col-md-4 col-lg-2">
                        <a asp-action="Analytics" class="btn btn-outline-info w-100 py-3">
                            <i class="bi bi-graph-up fs-4 d-block mb-1"></i>
                            <small>Analytics</small>
                        </a>
                    </div>
                    <div class="col-md-4 col-lg-2">
                        <a asp-action="Backup" class="btn btn-outline-success w-100 py-3">
                            <i class="bi bi-hdd fs-4 d-block mb-1"></i>
                            <small>Database Backup</small>
                        </a>
                    </div>
                    <div class="col-md-4 col-lg-2">
                        <a asp-action="DataCleanup" class="btn btn-outline-warning w-100 py-3">
                            <i class="bi bi-trash fs-4 d-block mb-1"></i>
                            <small>Data Cleanup</small>
                        </a>
                    </div>
                    <div class="col-md-4 col-lg-2">
                        <a asp-action="RolePermissions" class="btn btn-outline-secondary w-100 py-3">
                            <i class="bi bi-shield-lock fs-4 d-block mb-1"></i>
                            <small>Role Permissions</small>
                        </a>
                    </div>
                    <div class="col-md-4 col-lg-2">
                        <a asp-action="EmailSettings" class="btn btn-outline-primary w-100 py-3">
                            <i class="bi bi-envelope-at fs-4 d-block mb-1"></i>
                            <small>Email Settings</small>
                        </a>
                    </div>
                </div>
                <hr class="my-3" />
                <div class="row g-3">
                    <div class="col-md-3">
                        <a asp-action="Users" class="btn btn-light w-100">
                            <i class="bi bi-people me-1"></i> User Management
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a asp-action="Suppliers" class="btn btn-light w-100">
                            <i class="bi bi-building me-1"></i> Supplier Management
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a asp-action="Customers" class="btn btn-light w-100">
                            <i class="bi bi-person-badge me-1"></i> Customer Management
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a asp-action="CurrencySettings" class="btn btn-light w-100">
                            <i class="bi bi-currency-exchange me-1"></i> Currency Settings
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>