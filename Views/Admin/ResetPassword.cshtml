@model InvoiceManagement.Models.User

@{
    ViewData["Title"] = $"Reset Password - {Model.FullName}";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-key"></i> Reset Password</h1>
    <a asp-action="Users" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Users
    </a>
</div>

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-circle"></i> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-person-lock"></i> Reset Password for @Model.FullName</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> You are about to reset the password for:
                    <ul class="mb-0 mt-2">
                        <li><strong>Username:</strong> @Model.Username</li>
                        <li><strong>Email:</strong> @Model.Email</li>
                        <li><strong>Role:</strong> @Model.Role.Replace("_", " ")</li>
                    </ul>
                </div>

                <form asp-action="ResetPassword" asp-route-id="@Model.Id" method="post">
                    @Html.AntiForgeryToken()
                    
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">New Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required minlength="6" placeholder="Enter new password">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword', this)">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <div class="form-text">Password must be at least 6 characters long.</div>
                    </div>

                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required minlength="6" placeholder="Confirm new password">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword', this)">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="generatePassword" onchange="generateRandomPassword()">
                            <label class="form-check-label" for="generatePassword">
                                Generate a random password
                            </label>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary" onclick="return validatePasswords()">
                            <i class="bi bi-check-circle"></i> Reset Password
                        </button>
                        <a asp-action="UserProfile" asp-route-id="@Model.Id" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card shadow mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-shield-check"></i> Password Guidelines</h5>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li>Minimum 6 characters</li>
                    <li>Consider using a mix of letters, numbers, and symbols</li>
                    <li>Avoid common words or personal information</li>
                    <li>Don't reuse passwords from other accounts</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function togglePassword(inputId, button) {
            var input = document.getElementById(inputId);
            var icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        }

        function generateRandomPassword() {
            var checkbox = document.getElementById('generatePassword');
            var newPassword = document.getElementById('newPassword');
            var confirmPassword = document.getElementById('confirmPassword');
            
            if (checkbox.checked) {
                var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
                var password = '';
                for (var i = 0; i < 12; i++) {
                    password += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                newPassword.value = password;
                confirmPassword.value = password;
                newPassword.type = 'text';
                confirmPassword.type = 'text';
            } else {
                newPassword.value = '';
                confirmPassword.value = '';
                newPassword.type = 'password';
                confirmPassword.type = 'password';
            }
        }

        function validatePasswords() {
            var newPassword = document.getElementById('newPassword').value;
            var confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long.');
                return false;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match.');
                return false;
            }
            
            return confirm('Are you sure you want to reset the password for this user?');
        }
    </script>
}
