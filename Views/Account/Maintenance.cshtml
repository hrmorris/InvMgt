@model dynamic

@{
    Layout = null;
    var message = ViewBag.MaintenanceMessage as string ?? "The system is currently undergoing scheduled maintenance. We'll be back shortly.";
    var endTime = ViewBag.MaintenanceEndTime as string ?? "";
    var companyName = ViewBag.CompanyName as string ?? ViewData["AppName"] as string ?? "Invoice Management System";

    // Pull appearance/branding from the global AppearanceViewDataFilter
    var faviconUrl = ViewData["Branding_FaviconUrl"] as string ?? "";
    var logoUrl = ViewData["Branding_LogoUrl"] as string ?? "";
    var primaryColor = ViewData["Theme_PrimaryColor"] as string ?? "#0d6efd";
    var accentColor = ViewData["Theme_AccentColor"] as string ?? "#198754";
    var fontFamily = ViewData["Theme_FontFamily"] as string ?? "Segoe UI";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>System Maintenance | @companyName</title>
    @if (!string.IsNullOrEmpty(faviconUrl))
    {
        <link rel="icon" href="@faviconUrl" />
    }
    else
    {
        <link rel="icon" type="image/svg+xml"
              href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“„</text></svg>">
    }
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    @if (fontFamily != "Segoe UI" && fontFamily != "system-ui")
    {
        <link href="https://fonts.googleapis.com/css2?family=@(fontFamily.Replace(" ", "+"))&display=swap" rel="stylesheet">
    }
    <style>
            :root {
                --primary: @primaryColor;
                --primary-dark: @accentColor;
            }

            body {
                background: linear-gradient(135deg, @primaryColor 0%, @accentColor 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: '@fontFamily', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                overflow: hidden;
            }

            .maintenance-card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border-radius: 24px;
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
                max-width: 600px;
                width: 90%;
                padding: 3rem;
                text-align: center;
                animation: slideUp 0.8s ease-out;
            }

            @@keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(40px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .maintenance-icon {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                background: linear-gradient(135deg, #ff9a56 0%, #ff6a00 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 2rem;
                animation: pulse 2s ease-in-out infinite;
            }

            @@keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.05);
                }
            }

            .maintenance-icon i {
                font-size: 3.5rem;
                color: white;
            }

            .maintenance-title {
                font-size: 2rem;
                font-weight: 700;
                color: #1a1a2e;
                margin-bottom: 1rem;
            }

            .maintenance-message {
                font-size: 1.1rem;
                color: #555;
                line-height: 1.7;
                margin-bottom: 1.5rem;
            }

            .eta-badge {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
                color: #0c5460;
                padding: 0.75rem 1.5rem;
                border-radius: 50px;
                font-weight: 600;
                font-size: 1rem;
                margin-bottom: 1.5rem;
                border: 1px solid rgba(12, 84, 96, 0.1);
            }

            .eta-badge i {
                font-size: 1.2rem;
            }

            .progress-bar-animated {
                height: 4px;
                border-radius: 2px;
                background: #e9ecef;
                overflow: hidden;
                margin-bottom: 2rem;
            }

            .progress-bar-animated .bar {
                height: 100%;
                background: linear-gradient(90deg, var(--primary), var(--primary-dark), var(--primary));
                background-size: 200% 100%;
                animation: shimmer 2s linear infinite;
                width: 100%;
            }

            @@keyframes shimmer {
                0% {
                    background-position: -200% 0;
                }
                100% {
                    background-position: 200% 0;
                }
            }

            .brand-footer {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                color: #888;
                font-size: 0.9rem;
            }

            .brand-footer i {
                color: var(--primary);
            }

            .gear-bg {
                position: fixed;
                opacity: 0.03;
                font-size: 300px;
                color: white;
                animation: rotate 20s linear infinite;
            }

            .gear-bg.top-left {
                top: -100px;
                left: -100px;
            }

            .gear-bg.bottom-right {
                bottom: -100px;
                right: -100px;
                animation-direction: reverse;
            }

            @@keyframes rotate {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }

            .login-link {
                color: var(--primary);
                text-decoration: none;
                font-weight: 500;
                transition: all 0.2s;
            }

            .login-link:hover {
                color: var(--primary-dark);
                text-decoration: underline;
            }

            #countdown {
                font-variant-numeric: tabular-nums;
            }
    </style>
</head>
<body>
    <!-- Background decorative gears -->
    <i class="bi bi-gear-fill gear-bg top-left"></i>
    <i class="bi bi-gear-fill gear-bg bottom-right"></i>

    <div class="maintenance-card">
        @if (!string.IsNullOrEmpty(logoUrl))
        {
            <img src="@logoUrl" alt="@companyName" style="height: 50px; max-width: 180px; object-fit: contain; margin-bottom: 1rem;" />
        }
        <div class="maintenance-icon">
            <i class="bi bi-wrench-adjustable-circle"></i>
        </div>

        <h1 class="maintenance-title">Under Maintenance</h1>

        <div class="progress-bar-animated">
            <div class="bar"></div>
        </div>

        <p class="maintenance-message">@message</p>

        @if (!string.IsNullOrEmpty(endTime))
        {
            <div class="eta-badge">
                <i class="bi bi-clock-history"></i>
                <span>Estimated return: <strong>@endTime</strong></span>
            </div>
            <br />
            <div id="countdown" class="text-muted mb-3" style="font-size: 0.95rem;"></div>
        }

        <div class="brand-footer">
            <i class="bi bi-receipt"></i>
            <span>@companyName</span>
        </div>

        <div class="mt-3">
            <a href="/Account/Login" class="login-link">
                <i class="bi bi-box-arrow-in-right"></i> Administrator Login
            </a>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(endTime))
    {
        <script>
                    (function () {
                        const endTimeStr = '@Html.Raw(endTime)';
                        const countdownEl = document.getElementById('countdown');
                        if (!countdownEl || !endTimeStr) return;

                        function parseEndTime(str) {
                            // Try parsing various formats
                            const d = new Date(str);
                            if (!isNaN(d.getTime())) return d;
                            return null;
                        }

                        const target = parseEndTime(endTimeStr);
                        if (!target) {
                            countdownEl.style.display = 'none';
                            return;
                        }

                        function updateCountdown() {
                            const now = new Date();
                            const diff = target - now;
                            if (diff <= 0) {
                                countdownEl.innerHTML = '<i class="bi bi-check-circle text-success"></i> Maintenance should be complete â€” <a href="/" class="login-link">try refreshing</a>';
                                return;
                            }

                            const hours = Math.floor(diff / 3600000);
                            const minutes = Math.floor((diff % 3600000) / 60000);
                            const seconds = Math.floor((diff % 60000) / 1000);

                            let parts = [];
                            if (hours > 0) parts.push(hours + 'h');
                            parts.push(minutes + 'm');
                            parts.push(seconds + 's');

                            countdownEl.innerHTML = '<i class="bi bi-hourglass-split"></i> Time remaining: <strong>' + parts.join(' ') + '</strong>';
                            setTimeout(updateCountdown, 1000);
                        }

                        updateCountdown();
                    })();
        </script>
    }
</body>

</html>