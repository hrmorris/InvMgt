@model Invoice

@{
    ViewData["Title"] = "View Imported Invoice";
    var index = ViewBag.Index;
}
@functions {
    public string FormatCurrency(decimal amount)
    {
        var settings = ViewData["CurrencySettings"] as CurrencySettings;
        if (settings != null)
        {
            return CurrencyHelper.FormatCurrency(amount, settings);
        }
        return $"K {amount:N2}";
    }
    public string CurrencySymbol()
    {
        return ViewData["CurrencySymbol"]?.ToString() ?? "K";
    }
}


<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-eye"></i> View Imported Invoice Details</h1>
</div>

<div class="alert alert-info">
    <i class="bi bi-robot"></i> <strong>Extracted by Gemini 2.5 Pro:</strong> This invoice was automatically extracted using advanced AI document analysis.
</div>

<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h4 class="m-0">Invoice: @Model.InvoiceNumber</h4>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Invoice Information -->
            <div class="col-md-6">
                <h5 class="text-primary mb-3">Invoice Information</h5>
                <dl class="row">
                    <dt class="col-sm-4">Invoice Number:</dt>
                    <dd class="col-sm-8"><strong>@Model.InvoiceNumber</strong></dd>

                    <dt class="col-sm-4">Invoice Date:</dt>
                    <dd class="col-sm-8">@Model.InvoiceDate.ToString("dd/MM/yyyy")</dd>

                    <dt class="col-sm-4">Due Date:</dt>
                    <dd class="col-sm-8">@Model.DueDate.ToString("dd/MM/yyyy")</dd>

                    <dt class="col-sm-4">Total Amount:</dt>
                    <dd class="col-sm-8"><strong class="text-success fs-5">@FormatCurrency(Model.TotalAmount)</strong></dd>
                </dl>
            </div>

            <!-- Customer Information -->
            <div class="col-md-6">
                <h5 class="text-primary mb-3">Customer Information</h5>
                <dl class="row">
                    <dt class="col-sm-4">Name:</dt>
                    <dd class="col-sm-8"><strong>@Model.CustomerName</strong></dd>

                    @if (!string.IsNullOrEmpty(Model.CustomerAddress))
                    {
                        <dt class="col-sm-4">Address:</dt>
                        <dd class="col-sm-8">@Model.CustomerAddress</dd>
                    }

                    @if (!string.IsNullOrEmpty(Model.CustomerEmail))
                    {
                        <dt class="col-sm-4">Email:</dt>
                        <dd class="col-sm-8"><a href="mailto:@Model.CustomerEmail">@Model.CustomerEmail</a></dd>
                    }

                    @if (!string.IsNullOrEmpty(Model.CustomerPhone))
                    {
                        <dt class="col-sm-4">Phone:</dt>
                        <dd class="col-sm-8">@Model.CustomerPhone</dd>
                    }
                </dl>
            </div>
        </div>

        <!-- Line Items -->
        @if (Model.InvoiceItems != null && Model.InvoiceItems.Any())
        {
            <hr />
            <h5 class="text-primary mb-3">Line Items (@Model.InvoiceItems.Count)</h5>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-primary">
                        <tr>
                            <th>Description</th>
                            <th class="text-center" style="width: 100px;">Quantity</th>
                            <th class="text-end" style="width: 120px;">Unit Price</th>
                            <th class="text-end" style="width: 120px;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.InvoiceItems)
                        {
                            <tr>
                                <td>@item.Description</td>
                                <td class="text-center">@item.Quantity</td>
                                <td class="text-end">@FormatCurrency(item.UnitPrice)</td>
                                <td class="text-end"><strong>@FormatCurrency(item.TotalPrice)</strong></td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr class="table-success fw-bold">
                            <td colspan="3" class="text-end">Total Amount:</td>
                            <td class="text-end fs-5">@FormatCurrency(Model.TotalAmount)</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        }

        <!-- Notes -->
        @if (!string.IsNullOrEmpty(Model.Notes))
        {
            <hr />
            <h5 class="text-primary mb-3">Notes</h5>
            <div class="alert alert-light">
                @Model.Notes
            </div>
        }
    </div>
    <div class="card-footer">
        <a asp-action="EditInvoice" asp-route-index="@index" class="btn btn-primary btn-lg">
            <i class="bi bi-pencil"></i> Edit Invoice
        </a>
        <a asp-action="DeleteInvoice" asp-route-index="@index" class="btn btn-danger btn-lg">
            <i class="bi bi-trash"></i> Delete
        </a>
        <a asp-action="ReviewInvoices" class="btn btn-secondary btn-lg">
            <i class="bi bi-arrow-left"></i> Back to Review
        </a>
    </div>
</div>

